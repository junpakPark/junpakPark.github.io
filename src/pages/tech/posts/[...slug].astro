---
import { slugify } from "../../../utils";
import MainLayout from "../../../layouts/MainLayout.astro";
import PostLayout from "../../../layouts/PostLayout.astro";

import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const allPosts: CollectionEntry<"blog">[] = await getCollection("blog");
  const sortedPosts = allPosts.sort(
    (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
      b.data.date.valueOf() - a.data.date.valueOf()
  );

  return sortedPosts.map((post, index, posts) => ({
    params: {
      slug: slugify(post.slug),
    },
    props: {
      currentPost: post,
      prevPost: posts[index + 1],
      nextPost: posts[index - 1],
    },
  }));
}
const { currentPost, prevPost, nextPost } = Astro.props;
const { Content, headings } = await currentPost.render();
---

<MainLayout>
  <PostLayout
    currentPost={currentPost}
    prevPost={prevPost}
    nextPost={nextPost}
    headings={headings}
  >
    <Content />
  </PostLayout>
</MainLayout>
