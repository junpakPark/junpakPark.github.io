---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostList from "../../components/PostList";
import {slugify} from "../../utils";

import {getCollection} from "astro:content";
import type {CollectionEntry} from "astro:content";
import MainLayout from "../../layouts/MainLayout.astro";
import ContentLayout from "../../layouts/ContentLayout.astro";

export async function getStaticPaths() {
    const allPosts: CollectionEntry<"blog">[] = await getCollection("blog");
    const allTags = [...new Set(allPosts.map(post => post.data.tags).flat())];

    return allTags.map(tag => {
        const tagedPosts = allPosts
            .filter(post => post.data.tags.includes(tag))
            .sort(
                (a: CollectionEntry<"blog">, b: CollectionEntry<"blog">) =>
                    b.data.date.valueOf() - a.data.date.valueOf()
            );

        return {
            params: {
                slug: slugify(tag),
            },
            props: {
                tag,
                tagedPosts,
            },
        };
    });
}
const {slug} = Astro.params;
const {tag, tagedPosts} = Astro.props;
---
<BaseLayout>
    <MainLayout>
        <ContentLayout>
            <div class="space-y-4">
                <h1 class="text-2xl font-semibold">
                    <span class="text-purple-600"> {tagedPosts.length} </span>
                    Posts about
                    <span class="text-purple-600"> {tag} </span>
                    tags!
                </h1>
                <PostList posts={tagedPosts}/>
            </div>
        </ContentLayout>
    </MainLayout>
</BaseLayout>
